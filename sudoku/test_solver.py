import pytest
from solver import solve_sudoku, read_sudoku, write_sudoku

# run with `python -m pytest test_solver.py`


@pytest.mark.parametrize(
    "sudoku_input, expected_output",
    [
        (
            """\
..61..345
8.1.4.72.
..36.2891
56..2.913
342..9.87
..73.....
.8...147.
.1.467...
.........
""",
            """\
926178345
851943726
473652891
568724913
342519687
197386254
685231479
219467538
734895162
""",
        ),
        (
            """
.49.31...
.3..7.98.
8...4....
..61578.2
.5.2841.6
.1......5
.857.34.9
..2..537.
..4.2.5.1
""",
            """
649831257
531672984
827549613
496157832
753284196
218396745
185763429
962415378
374928561
""",
        ),
        (
            """
..198476.
6...57...
8.7.1....
96.3.81.5
185.2..73
3.....2.8
21.....36
...1....4
.96..251.
""",
            """
531984762
649257381
827613459
962378145
185429673
374561298
218745936
753196824
496832517
""",
        ),
        (
            """
..87.4..3
1.73..2..
3.2...6.7
......5..
7....516.
.8..31.7.
..6..8..5
4...5....
85.94....
""",
            """
568724913
197386254
342519687
219467538
734895162
685231479
926178345
473652891
851943726
""",
        ),
        (
            """
9..72....
......34.
25...6...
.38.6.21.
......7..
....31..5
7.694.8.1
.451..92.
.9....4..
""",
            """
913724568
687519342
254386197
538467219
162895734
479231685
726943851
345178926
891652473
""",
        ),
        (
            """
2...7.3..
7.3916...
..6.8.15.
..1.94...
...1.....
....2.8..
.62...4.5
.7..5..28
.8...976.
""",
            """
218475396
753916284
496382157
531894672
827163549
649527831
962738415
374651928
185249763
""",
        ),
    ],
)
def test_sudoku_solver(sudoku_input, expected_output):
    solved_output = write_sudoku(solve_sudoku(read_sudoku(sudoku_input)))
    assert solved_output == expected_output.strip()


# these puzzles need more advanced techniques to solve (like trial and backtracking, invisible number technique, etc.)
@pytest.mark.parametrize(
    "sudoku_input",
    [
        (
            """
67..38429
314.95.86
..2.47...
..1.6....
.3.8..5.4
...32..67
56..8....
...4...5.
1.8...6.2
"""
        ),
        (
            """
....27...
...594.27
......6..
8..1.54..
.....8.53
..4......
.......6.
.9..3.1..
51...2...
"""
        ),
    ],
)
def test_insufficient_algorithm(sudoku_input):
    with pytest.raises(RuntimeError):
        solve_sudoku(read_sudoku(sudoku_input))


@pytest.mark.parametrize(
    "sudoku_input",
    [
        """
67.......
314......
..2......
..1......
........4
.........
.........
.........
.........
"""
    ],
)
def test_unsolvable_sudoku(sudoku_input):
    with pytest.raises(RuntimeError):
        solve_sudoku(read_sudoku(sudoku_input))
